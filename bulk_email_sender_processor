import smtplib
from email.mime.text import MIMEText
import csv

# Sample script for SEP Email Processor (bulk sender)

# Placeholders - replace with your details
smtp_server = 'smtp.example.com'
smtp_port = 25
username = 'your_username'
password = 'your_password'
from_email = 'your_email@example.com'
subject = 'Bulk Email Test'
body = 'This is a sample bulk email from SEP processor.'

# Assume recipients in a CSV file (column: 'email')
recipients_file = 'recipients.csv'

def send_bulk_emails(server, port, user, pwd, from_addr, subj, body_text, recipients_path):
    try:
        with open(recipients_path, 'r') as f:
            reader = csv.reader(f)
            recipients = [row[0] for row in reader if row]
        
        server = smtplib.SMTP(server, port)
        server.login(user, pwd)
        
        for to_email in recipients:
            msg = MIMEText(body_text)
            msg['Subject'] = subj
            msg['From'] = from_addr
            msg['To'] = to_email
            server.sendmail(from_addr, [to_email], msg.as_string())
            print(f'Email sent to {to_email}')
        
        server.quit()
        print('Bulk send complete!')
    except Exception as e:
        print(f'Error in bulk send: {e}')

# Run the bulk send
send_bulk_emails(smtp_server, smtp_port, username, password, from_email, subject, body, recipients_file)
